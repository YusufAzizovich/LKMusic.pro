<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>LKMusic</title>
<link rel="icon" type="image/jpg" href="—Ñ–∞–≤–∏–∫–æ–Ω.jpg">

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: radial-gradient(circle at top, #121212 0%, #0a0a0a 100%);
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px 20px;
  min-height: 100vh;
}

h2 {
  font-size: 48px;
  margin-bottom: 20px;
  text-transform: uppercase;
  letter-spacing: 3px;
  font-weight: 800;
  background: linear-gradient(90deg, #00ccff, #00ff88);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 10px rgba(0,255,136,0.5), 0 0 25px rgba(0,204,255,0.4);
  animation: glowShift 6s ease-in-out infinite alternate;
}

@keyframes glowShift {
  from { text-shadow: 0 0 10px #00ff88, 0 0 25px #00ccff; }
  to   { text-shadow: 0 0 10px #00ccff, 0 0 25px #00ff88; }
}

input[type="file"], button {
  margin: 10px 5px;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #00ffcc66;
  background: #222;
  color: #00ffcc;
  cursor: pointer;
  transition: 0.3s;
}
button { background: linear-gradient(90deg, #00ccff, #00ff88); color: #000; font-weight: bold; border: none; }
button:hover { transform: scale(1.07); } 
button:active { transform: scale(0.96); }

.player-box {
  padding: 12px;
  border-radius: 15px;
  background: linear-gradient(270deg, #00ccff, #00ff88, #00ccff);
  background-size: 400% 400%;
  animation: gradientMove 6s ease infinite;
  box-shadow: 0 0 20px rgba(0,255,136,0.5), 0 0 30px rgba(0,204,255,0.5);
  margin-bottom: 20px;
}
audio {
  width: 320px;
  border-radius: 10px;
  background: #0d0d0d;
}
@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.list-box {
  background: rgba(40,40,40,0.7);
  border-radius: 15px;
  padding: 10px;
  box-shadow: 0 0 15px rgba(0,255,136,0.3);
  margin-bottom: 20px;
  width: 260px;
}

.list-box h3 {
  text-align: center;
  margin-top: 0;
  color: #00ffcc;
}

ul { list-style: none; padding: 0; margin: 0; }
li {
  padding: 8px 12px;
  border-radius: 12px;
  background: rgba(0,0,0,0.2);
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: 0.25s;
}
li:hover { background: rgba(0,255,136,0.15); transform: translateX(3px); }
li.active { background: rgba(0,255,136,0.15); }

/* üî• –ù–ï–û–ù–û–í–ê–Ø –ü–û–î–°–í–ï–¢–ö–ê –ê–ö–¢–ò–í–ù–û–ì–û –ü–õ–ï–ô–õ–ò–°–¢–ê */
#playlistList li.active {
  background: rgba(0, 255, 150, 0.25);
  box-shadow: 0 0 10px #00ff99, 0 0 20px #00e6ff;
  transform: translateX(5px);
  animation: neonGlow 1.2s ease-in-out infinite alternate;
}

@keyframes neonGlow {
  from { box-shadow: 0 0 6px #00ff99, 0 0 15px #00e6ff; }
  to   { box-shadow: 0 0 14px #00ffcc, 0 0 30px #00ccff; }
}

.delete-btn {
  background: #ff3b3b;
  border: none;
  color: #fff;
  cursor: pointer;
  border-radius: 8px;
  padding: 4px 8px;
}
.edit-btn {
  background: #ffaa00;
  border: none;
  color: #000;
  cursor: pointer;
  border-radius: 8px;
  padding: 4px 8px;
}

.toggle-btn {
  width: 100%;
  padding: 10px;
  background: linear-gradient(90deg, #00ccff, #00ff88);
  border: none;
  border-radius: 12px;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  margin-bottom: 8px;
  transition: 0.3s;
}
.toggle-btn:hover { transform: scale(1.03); }

.collapsible {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 0.4s ease, opacity 0.3s ease;
}
.collapsible.open {
  max-height: 400px;
  opacity: 1;
}
/* üì± –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
@media (max-width: 600px) {

  body {
    padding: 20px 10px;
    align-items: stretch;
  }

  h2 {
    font-size: 34px;
    text-align: center;
  }

  .player-box {
    width: 100%;
    padding: 10px;
  }

  audio {
    width: 100%;
  }

  /* –ö—Ä—É–ø–Ω–µ–µ –∫–Ω–æ–ø–∫–∏ */
  button, 
  input[type="file"] {
    width: 100%;
    font-size: 18px;
    padding: 14px;
    margin: 8px 0;
    border-radius: 14px;
  }

  .toggle-btn {
    font-size: 18px;
    padding: 14px;
  }

  /* –ë–ª–æ–∫–∏ —Å–ø–∏—Å–∫–æ–≤ */
  .list-box {
    width: 100%;
    padding: 15px;
  }

  .list-box h3 {
    font-size: 22px;
  }

  ul li {
    padding: 14px;
    font-size: 17px;
    border-radius: 14px;
  }

  /* –ö—Ä—É–ø–Ω–µ–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å */
  .delete-btn,
  .edit-btn {
    padding: 8px 12px;
    font-size: 16px;
    border-radius: 10px;
  }

  /* –ü–ª–µ–π–ª–∏—Å—Ç */
  #playlist {
    width: 100%;
    margin-top: 10px;
  }

  #playlist li {
    font-size: 18px;
    padding: 14px 16px;
  }

  /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  #prevBtn,
  #nextBtn,
  #randomBtn,
  #shuffleBtn {
    width: 48%;
    margin: 5px 1%;
    font-size: 18px;
    padding: 14px;
    border-radius: 12px;
  }

  /* –ü–ª–µ–π–ª–∏—Å—Ç—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–π—Å—è –±–ª–æ–∫ */
  #playlistsWrapper {
    max-height: 500px;
  }
}

</style>
</head>

<body>

<h2>üéµ LKMusic</h2>

<div>
  <button id="newPlaylistBtn">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</button>
  <input type="file" id="fileInput" accept="audio/*" multiple>
</div>

<div class="list-box">
  <button id="togglePlaylists" class="toggle-btn">üìÇ –ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
  <div id="playlistsWrapper" class="collapsible">
    <ul id="playlistList"></ul>
  </div>
</div>

<div class="list-box">
  <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
  <ul id="historyList"></ul>
</div>

<div class="player-box">
  <audio id="audioPlayer" controls></audio>
</div>

<div>
  <button id="prevBtn">< –ù–∞–∑–∞–¥</button>
  <button id="nextBtn">–í–ø–µ—Ä—ë–¥ ></button>
  <button id="randomBtn">üé≤ –†–∞–Ω–¥–æ–º</button>
  <button id="shuffleBtn"><img src="shuffle.png" height="15px"> –ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
</div>

<ul id="playlist"></ul>

<script>
const fileInput = document.getElementById('fileInput');
const audioPlayer = document.getElementById('audioPlayer');
const playlistEl = document.getElementById('playlist');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const randomBtn = document.getElementById('randomBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const newPlaylistBtn = document.getElementById('newPlaylistBtn');
const playlistListEl = document.getElementById('playlistList');
const historyEl = document.getElementById('historyList');

let db, playlists = [], playlist = [], activePlaylistId = null, currentIndex = 0, history = [];

const request = indexedDB.open('offlineMusicDB', 11);
request.onupgradeneeded = e => {
  db = e.target.result;
  if(!db.objectStoreNames.contains('playlists')) db.createObjectStore('playlists', { keyPath: 'id', autoIncrement: true });
  if(!db.objectStoreNames.contains('history')) db.createObjectStore('history', { keyPath: 'id', autoIncrement: true });
};
request.onsuccess = e => { db = e.target.result; loadPlaylists(); loadHistory(); };

newPlaylistBtn.onclick = () => {
  const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞:');
  if(!name) return;
  const tx = db.transaction(['playlists'], 'readwrite');
  tx.objectStore('playlists').add({ name, tracks: [] }).onsuccess = loadPlaylists;
};

function loadPlaylists() {
  db.transaction(['playlists'], 'readonly')
    .objectStore('playlists').getAll().onsuccess = e => {
      playlists = e.target.result;
      renderPlaylistList();
      if(activePlaylistId) selectPlaylist(activePlaylistId);
    };
}

function renderPlaylistList() {
  playlistListEl.innerHTML = '';
  playlists.forEach(p => {
    const li = document.createElement('li');
    if (p.id === activePlaylistId) li.classList.add('active');

    const span = document.createElement('span');
    span.textContent = p.name;
    span.style.flex = '1';
    span.onclick = () => selectPlaylist(p.id);

    const edit = document.createElement('button');
    edit.textContent = '‚úé';
    edit.className = 'edit-btn';
    edit.onclick = e => {
      e.stopPropagation();
      const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', p.name);
      if(newName){
        p.name = newName;
        db.transaction(['playlists'],'readwrite')
          .objectStore('playlists').put(p).onsuccess = loadPlaylists;
      }
    };

    const del = document.createElement('button');
    del.textContent='‚úï';
    del.className='delete-btn';
    del.onclick = e => {
      e.stopPropagation();
      if(confirm('–£–¥–∞–ª–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç?')){
        db.transaction(['playlists'],'readwrite')
          .objectStore('playlists').delete(p.id);
        if(p.id===activePlaylistId){
          playlist = [];
          activePlaylistId = null;
          audioPlayer.src = '';
        }
        loadPlaylists();
      }
    };

    li.appendChild(span);
    li.appendChild(edit);
    li.appendChild(del);
    playlistListEl.appendChild(li);
  });
}

function selectPlaylist(id) {
  activePlaylistId = id;
  const pl = playlists.find(x=>x.id===id);
  playlist = pl.tracks.map(t => ({ name: t.name, blob: t.blob, url: URL.createObjectURL(t.blob) }));
  currentIndex = 0;
  renderPlaylist();
  if(playlist.length) playTrack();
}

fileInput.onchange = () => {
  if(activePlaylistId===null) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç!");
  const files = [...fileInput.files];
  const pl = playlists.find(x=>x.id===activePlaylistId);

  files.forEach(f=>{
    const track = { name: f.name, blob: f, url: URL.createObjectURL(f) };
    pl.tracks.push(track);
    playlist.push(track);
  });

  renderPlaylist();
  db.transaction(['playlists'],'readwrite')
    .objectStore('playlists').put(pl);
};

function renderPlaylist() {
  playlistEl.innerHTML = '';
  playlist.forEach((t,i)=>{
    const li = document.createElement('li');
    if(i===currentIndex) li.classList.add('active');

    const span=document.createElement('span');
    span.textContent=t.name;
    span.style.flex='1';
    span.onclick=()=>{ currentIndex=i; playTrack(); };

    const del=document.createElement('button');
    del.textContent='‚úï';
    del.className='delete-btn';
    del.onclick=e=>{
      e.stopPropagation();
      playlist.splice(i,1);
      const pl = playlists.find(p=>p.id===activePlaylistId);
      pl.tracks.splice(i,1);
      db.transaction(['playlists'],'readwrite')
        .objectStore('playlists').put(pl);
      if(currentIndex>=playlist.length) currentIndex=playlist.length-1;
      renderPlaylist();
      if(playlist.length) playTrack(); else audioPlayer.src='';
    };

    li.appendChild(span);
    li.appendChild(del);
    playlistEl.appendChild(li);
  });
}

function loadHistory() {
  db.transaction(['history'],'readonly')
    .objectStore('history').getAll().onsuccess = e => {
      history = e.target.result.slice(-5).reverse();
      renderHistory();
    };
}

function renderHistory() {
  historyEl.innerHTML = '';
  history.forEach(t=>{
    const li=document.createElement('li');
    li.textContent='üéµ '+t.name;
    li.onclick=()=>{
      const idx = playlist.findIndex(x=>x.name===t.name);
      if(idx!==-1){ currentIndex=idx; playTrack(); }
    };
    historyEl.appendChild(li);
  });
}

function saveHistoryTrack(track) {
  db.transaction(['history'],'readwrite')
    .objectStore('history').add({ name: track.name, blob: track.blob });
}

/* üî• –§–£–ù–ö–¶–ò–Ø –ü–û–î–°–í–ï–¢–ö–ò –ê–ö–¢–ò–í–ù–û–ì–û –ü–õ–ï–ô–õ–ò–°–¢–ê */
function highlightActivePlaylist() {
  const items = playlistListEl.querySelectorAll('li');
  items.forEach(li => li.classList.remove('active'));

  const active = [...items].find(li =>
    li.querySelector('span').textContent === playlists.find(p => p.id === activePlaylistId)?.name
  );
  if(active) active.classList.add('active');
}

function playTrack() {
  if (!playlist.length) return;
  const tr = playlist[currentIndex];
  audioPlayer.src = tr.url;
  audioPlayer.play();

  renderPlaylist();
  updateHistory(tr);
  highlightActivePlaylist(); // üî• –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞
}

function updateHistory(track) {
  history = history.filter(t=>t.name!==track.name);
  history.unshift(track);
  if(history.length>5) history.pop();
  renderHistory();
  saveHistoryTrack(track);
}

prevBtn.onclick = ()=>{ currentIndex=(currentIndex-1+playlist.length)%playlist.length; playTrack(); };
nextBtn.onclick = ()=>{ currentIndex=(currentIndex+1)%playlist.length; playTrack(); };
audioPlayer.onended = ()=>{ currentIndex=(currentIndex+1)%playlist.length; playTrack(); };
randomBtn.onclick = ()=>{ currentIndex=Math.floor(Math.random()*playlist.length); playTrack(); };

shuffleBtn.onclick = ()=>{
  for(let i=playlist.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [playlist[i],playlist[j]]=[playlist[j],playlist[i]];
  }
  currentIndex=0;
  const pl=playlists.find(p=>p.id===activePlaylistId);
  pl.tracks=playlist.map(t=>({name:t.name,blob:t.blob}));
  db.transaction(['playlists'],'readwrite')
    .objectStore('playlists').put(pl);
  renderPlaylist();
  playTrack();
};

document.getElementById('togglePlaylists').onclick = () => {
  document.getElementById('playlistsWrapper').classList.toggle('open');
};
</script>

</body>
</html>
